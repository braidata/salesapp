generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model order_items {
  id       Int     @id @default(autoincrement())
  order_id Int
  sku      String  @db.VarChar(255)
  name     String? @db.VarChar(255)
  price    String? @db.VarChar(255)
  quantity String  @db.VarChar(255)
  discount String? @db.VarChar(255)
  orders   orders  @relation(fields: [order_id], references: [id])

  @@index([order_id])
}

model orders {
  id                                  Int           @id @default(autoincrement())
  customer_name                       String?       @default("sin detalle contacto") @db.VarChar(255)
  customer_rut                        String?       @default("sin detalle contacto") @db.VarChar(255)
  customer_email                      String?       @default("sin detalle contacto") @db.VarChar(255)
  customer_phone                      String?       @default("sin detalle contacto") @db.VarChar(255)
  billing_street                      String        @db.VarChar(255)
  billing_number                      String        @db.VarChar(255)
  billing_department                  String?       @default("sin n depto") @db.VarChar(255)
  billing_region                      String        @db.VarChar(255)
  billing_city                        String        @db.VarChar(255)
  billing_commune                     String        @db.VarChar(255)
  billing_zip_code                    String?       @default("sin zip code") @db.VarChar(255)
  billing_company_name                String        @db.VarChar(255)
  billing_company_rut                 String        @db.VarChar(255)
  billing_company_business            String        @db.VarChar(255)
  Shipping_Tipo_de_Despacho           String?       @default("sin envio") @db.VarChar(255)
  Shipping_Fecha_de_Despacho_o_Retiro String?       @default("sin envio") @db.VarChar(255)
  Shipping_Rut_Retira                 String?       @default("sin envio") @db.VarChar(255)
  Shipping_Nombre_Retira              String?       @default("sin envio") @db.VarChar(255)
  Shipping_Observacion                String?       @default("sin envio") @db.VarChar(255)
  Shipping_flete                      String?       @default("sin envio") @db.VarChar(255)
  customer_last_name                  String?       @default("sin datos de contacto") @db.VarChar(255)
  user                                String        @db.VarChar(255)
  dealId                              String        @unique @db.VarChar(255)
  Shipping_city                       String?       @default("sin envio") @db.VarChar(255)
  Shipping_commune                    String?       @default("sin envio") @db.VarChar(255)
  Shipping_department                 String?       @default("sin envio") @db.VarChar(255)
  Shipping_number                     String?       @default("sin envio") @db.VarChar(255)
  Shipping_region                     String?       @default("sin envio") @db.VarChar(255)
  Shipping_street                     String?       @default("sin envio") @db.VarChar(255)
  Shipping_zip_code                   String?       @default("sin envio") @db.VarChar(255)
  order_date                          DateTime?     @default(now())
  ownerId                             Int?
  sapID                               String?       @db.VarChar(255)
  statusSAP                           String?       @default("Procesando") @db.VarChar(255)
  dateSAP                             String?       @db.VarChar(255)
  ownerIdM                            String?
  team                                String?       @db.VarChar(255)
  OC                                  String?       @db.VarChar(255)
  almacen                             String?       @db.VarChar(255)
  centro                              String?       @db.VarChar(255)
  channel                             String?       @db.VarChar(255)
  order_class                         String?       @db.VarChar(255)
  respuestaSAP                        String?       @db.Text
  status                              String?       @default("1") @db.VarChar(255)
  creator                             String?       @db.VarChar(255)
  payments                            payments[]
  order_items                         order_items[]
  posts                               posts[]
}

model payments {
  id             Int     @id @default(autoincrement())
  order_id       Int
  method         String? @default("sin pago") @db.VarChar(255)
  payment_amount String? @default("sin pago") @db.VarChar(255)
  type           String? @default("sin pago") @db.VarChar(255)
  orders         orders? @relation(fields: [order_id], references: [id])

  @@index([order_id])
}

model payments_validator {
  id                 Int     @id @default(autoincrement())
  order_id           Int
  payment_method     String? @default("sin datos") @db.VarChar(255)
  authorization_code String? @default("sin datos") @db.VarChar(255)
  payment_count      String? @default("sin datos") @db.VarChar(255)
  payment_amount     String? @default("sin datos") @db.VarChar(255)
  payment_date       String? @default("sin datos") @db.VarChar(255)
  rut_pagador        String? @default("sin datos") @db.VarChar(255)
  observation        String? @default("sin datos") @db.VarChar(255)
  status             String? @default("sin datos") @db.VarChar(255)
  order_date         String? @default("sin datos") @db.VarChar(255)
  validation_date    String? @default("sin datos") @db.VarChar(255)
  team               String? @default("sin datos") @db.VarChar(255)
  banco_destino      String? @default("sin datos") @db.VarChar(255)
  imagenUrl          String? @default("sin datos") @db.VarChar(255)
  textoImg           String? @default("sin datos") @db.VarChar(512)
  rut_cliente        String? @default("sin datos") @db.VarChar(255)
  createdBy          String?
  validatedBy        String?
  editedBy           String?
  sapId              String? @default("sin datos") @db.VarChar(255)
  contId             String? @default("sin datos") @db.VarChar(255)
  posts              posts[]
}

model users {
  id               Int            @id @default(autoincrement())
  name             String         @db.VarChar(255)
  email            String         @unique @db.VarChar(255)
  ownerId          Int            @unique
  password         String?        @db.VarChar(255)
  image            String?
  permissions      String?        @db.VarChar(255)
  rol              String?        @db.VarChar(255)
  team             String?        @db.VarChar(255)
  rut              String?        @db.VarChar(255)
  notifications    Notification[]
  messagesSent     Message[]      @relation("MessageSender")
  messagesReceived Message[]      @relation("MessageReceiver")
  conversations    Conversation[] @relation("UserConversations")
  comments         Comment[]
  posts            posts[]
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  content   String
  status    String   @default("unread")
  category  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      users    @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Message {
  id             Int           @id @default(autoincrement())
  senderId       Int
  receiverId     Int
  content        String
  status         String        @default("unread")
  category       String
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  conversationId Int?
  sender         users         @relation("MessageSender", fields: [senderId], references: [id])
  receiver       users         @relation("MessageReceiver", fields: [receiverId], references: [id])
  conversation   Conversation? @relation(fields: [conversationId], references: [id])

  @@index([senderId])
  @@index([receiverId])
  @@index([conversationId])
}

model Conversation {
  id        Int       @id @default(autoincrement())
  title     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  postId    Int?
  users     users[]   @relation("UserConversations")
  messages  Message[]
  post      posts?    @relation(fields: [postId], references: [id])

  @@index([postId])
}

model Comment {
  id        Int      @id @default(autoincrement())
  userId    Int
  postId    Int
  content   String
  status    String   @default("active")
  category  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      users    @relation(fields: [userId], references: [id])
  post      posts    @relation(fields: [postId], references: [id])

  @@index([userId])
  @@index([postId])
}

model posts {
  id                 Int                 @id @default(autoincrement())
  title              String
  content            String
  authorId           Int
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  orderId            Int?
  paymentValidatorId Int?
  author             users               @relation(fields: [authorId], references: [id])
  order              orders?             @relation(fields: [orderId], references: [id])
  paymentValidator   payments_validator? @relation(fields: [paymentValidatorId], references: [id])
  comments           Comment[]
  conversations      Conversation[]

  @@index([authorId])
  @@index([orderId])
  @@index([paymentValidatorId])
}

model aa74cd_95de_538d_992c_3f96ecb7beae_20230802205640_vrepl {
  id       Int     @id @default(autoincrement())
  order_id Int
  sku      String  @db.VarChar(255)
  name     String? @db.VarChar(255)
  price    String? @db.VarChar(255)
  quantity String  @db.VarChar(255)

  @@index([order_id], map: "order_items_order_id_idx")
  @@map("_69aa74cd_95de_538d_992c_3f96ecb7beae_20230802205640_vrepl")
}

model UserConversations {
  A Int
  B Int

  @@unique([A, B], map: "_UserConversations_AB_unique")
  @@index([B], map: "_UserConversations_B_index")
  @@map("_UserConversations")
}

model vtex_orders {
  id                    Int                   @id @default(autoincrement())
  vtex_order_id         String                @unique @db.VarChar(50)
  sequence              String?               @db.VarChar(50)
  status                String?               @db.VarChar(50)
  status_description    String?               @db.VarChar(100)
  total_value           Decimal?              @db.Decimal(12, 2)
  creation_date         DateTime?
  last_change           DateTime?
  authorized_date       DateTime?
  invoiced_date         DateTime?
  is_completed          Boolean               @default(false)
  customer_email        String?               @db.VarChar(255)
  customer_first_name   String?               @db.VarChar(100)
  customer_last_name    String?               @db.VarChar(100)
  customer_document     String?               @db.VarChar(50)
  customer_phone        String?               @db.VarChar(50)
  customer_is_corporate Boolean               @default(false)
  shipping_city         String?               @db.VarChar(100)
  shipping_state        String?               @db.VarChar(100)
  delivery_company      String?               @db.VarChar(100)
  raw_vtex_data         Json?
  created_at            DateTime              @default(now())
  updated_at            DateTime              @updatedAt
  vtex_order_items      vtex_order_items[]
  vtex_order_payments   vtex_order_payments[]

  @@index([creation_date])
  @@index([status])
  @@index([customer_email])
}

model vtex_order_items {
  id             Int         @id @default(autoincrement())
  vtex_order_id  Int
  vtex_unique_id String?     @db.VarChar(100)
  product_id     String?     @db.VarChar(50)
  ref_id         String?     @db.VarChar(100)
  product_name   String?     @db.VarChar(255)
  brand_name     String?     @db.VarChar(100)
  quantity       Int?
  unit_price     Decimal?    @db.Decimal(10, 2)
  selling_price  Decimal?    @db.Decimal(10, 2)
  vtex_order     vtex_orders @relation(fields: [vtex_order_id], references: [id])

  @@index([vtex_order_id])
  @@index([ref_id])
  @@index([product_id])
  @@index([brand_name])
}

model vtex_order_payments {
  id                  Int         @id @default(autoincrement())
  vtex_order_id       Int
  payment_system_name String?     @db.VarChar(100)
  payment_value       Decimal?    @db.Decimal(10, 2)
  installments        Int?
  vtex_order          vtex_orders @relation(fields: [vtex_order_id], references: [id])

  @@index([vtex_order_id])
  @@index([payment_system_name])
}

model sap_orders {
  id                 Int               @id @default(autoincrement())
  purchase_order     String            @unique @db.VarChar(50)
  sap_order          String            @unique @db.VarChar(20)
  customer_code      String            @db.VarChar(20)
  creation_date      DateTime?
  status             String?           @db.VarChar(100)
  status_code        String?           @db.VarChar(10)
  total_amount       Decimal?          @db.Decimal(12, 2)
  document_type      String?           @db.VarChar(10)
  document_type_text String?           @db.VarChar(100)
  document_number    String?           @db.VarChar(20)
  febos_fc           String?           @db.VarChar(100)
  raw_sap_data       Json?
  created_at         DateTime          @default(now())
  updated_at         DateTime          @updatedAt
  sap_order_items    sap_order_items[]

  @@index([purchase_order])
  @@index([sap_order])
  @@index([customer_code])
  @@index([creation_date])
  @@index([status_code])
}

model sap_order_items {
  id           Int        @id @default(autoincrement())
  sap_order_id Int
  sku          String     @db.VarChar(50)
  product_name String?    @db.VarChar(255)
  quantity     Int
  amount       Decimal    @db.Decimal(10, 2)
  sap_order    sap_orders @relation(fields: [sap_order_id], references: [id])

  @@index([sap_order_id])
  @@index([sku])
  @@index([product_name])
}

model ga4_daily_metrics {
  id                  Int      @id @default(autoincrement())
  date                DateTime @unique
  property_id         String?  @db.VarChar(50)
  sessions            Int      @default(0)
  total_users         Int      @default(0)
  new_users           Int      @default(0)
  page_views          Int      @default(0)
  ecommerce_purchases Int      @default(0)
  transaction_revenue Decimal? @default(0.00) @db.Decimal(12, 2)
  conversion_rate     Decimal? @default(0.00) @db.Decimal(5, 2)
  add_to_carts        Int      @default(0)
  abandoned_carts     Int      @default(0)
  abandonment_rate    Decimal? @default(0.00) @db.Decimal(5, 2)
  raw_ga4_data        Json?
  created_at          DateTime @default(now())

  @@index([date])
}

model ga4_traffic_sources {
  id              Int      @id @default(autoincrement())
  date            DateTime
  source          String   @db.VarChar(100)
  sessions        Int      @default(0)
  purchases       Int      @default(0)
  conversion_rate Decimal? @default(0.00) @db.Decimal(5, 2)

  @@unique([date, source])
  @@index([date])
  @@index([source])
}

model ga4_search_terms {
  id              Int      @id @default(autoincrement())
  date            DateTime
  search_term     String   @db.VarChar(255)
  sessions        Int      @default(0)
  purchases       Int      @default(0)
  conversion_rate Decimal? @default(0.00) @db.Decimal(5, 2)

  @@unique([date, search_term])
  @@index([date])
  @@index([search_term])
}

model ga4_product_metrics {
  id                Int      @id @default(autoincrement())
  date              DateTime
  item_name         String?  @db.VarChar(255)
  item_category     String?  @db.VarChar(100)
  item_brand        String?  @db.VarChar(100)
  item_views        Int      @default(0)
  item_add_to_carts Int      @default(0)
  item_purchases    Int      @default(0)
  item_revenue      Decimal? @default(0.00) @db.Decimal(10, 2)

  @@unique([date, item_name])
  @@index([date])
  @@index([item_name])
}

model analytics_summary {
  id                  Int      @id @default(autoincrement())
  date                DateTime @unique
  total_orders_vtex   Int      @default(0)
  total_orders_sap    Int      @default(0)
  total_revenue_vtex  Decimal? @default(0.00) @db.Decimal(12, 2)
  total_revenue_sap   Decimal? @default(0.00) @db.Decimal(12, 2)
  total_sessions_ga4  Int      @default(0)
  conversion_rate_ga4 Decimal? @default(0.00) @db.Decimal(5, 2)
  daily_order_value   Decimal? @default(0.00) @db.Decimal(12, 2)
  daily_session_value Decimal? @default(0.00) @db.Decimal(8, 2)
  cross_platform_rate Decimal? @default(0.00) @db.Decimal(5, 2)
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  @@index([date])
}

model sap_client {
  id                       Int       @id @default(autoincrement())
  client_rut               String    @unique @db.VarChar(50)
  client_nombre            String    @db.VarChar(255)
  client_apellido_paterno  String?   @db.VarChar(255)
  client_apellido_materno  String?   @db.VarChar(255)
  client_sexo              String?   @default("") @db.VarChar(255)
  client_celular           String?   @db.VarChar(50)
  client_telefono          String?   @db.VarChar(50)
  client_email             String?   @db.VarChar(255)
  client_calle             String?   @db.VarChar(255)
  client_numero_calle      String?   @db.VarChar(255)
  client_numero_casa_depto String?   @db.VarChar(255)
  client_region            String?   @db.VarChar(255)
  client_ciudad            String?   @db.VarChar(255)
  client_comuna            String?   @db.VarChar(255)
  client_giro              String?   @db.VarChar(255)
  client_owner_id          Int?
  creation_response        String?   @db.VarChar(255)
  created_by               String?   @db.VarChar(255)
  authorized_by            String?   @db.VarChar(255)
  updated_by               String?   @db.VarChar(255)
  created_at               DateTime  @default(now())
  authorized_at            DateTime?
  updated_at               DateTime  @updatedAt

  @@index([client_rut])
}
